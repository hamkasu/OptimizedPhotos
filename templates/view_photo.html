<!--
PhotoVault - Professional Photo Management Platform
Copyright (c) 2025 Calmic Sdn Bhd. All rights reserved.

This software is proprietary and confidential. Unauthorized copying, distribution,
modification, or use of this software is strictly prohibited.

Website: https://www.calmic.com.my
Email: support@calmic.com.my

CALMIC SDN BHD - "Committed to Excellence"
-->

{% extends "base.html" %}

{% block title %}{{ photo.original_filename }} - PhotoVault{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0" id="photoTitle">{{ photo.original_filename }}</h5>
                    <div class="btn-group" role="group">
                        <button class="btn btn-outline-secondary btn-sm" onclick="toggleRename()" title="Rename photo">
                            <i class="bi bi-pencil-square"></i>
                        </button>
                        <a href="{{ url_for('main.editor', photo_id=photo.id) }}" 
                           class="btn btn-outline-warning btn-sm" title="Edit photo">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{{ url_for('static', filename='uploads/' + photo.filename) }}" 
                           download="{{ photo.original_filename }}" 
                           class="btn btn-outline-success btn-sm" title="Download original">
                            <i class="bi bi-download"></i>
                        </a>
                        {% if photo.edited_filename %}
                        <a href="{{ url_for('static', filename='uploads/' + photo.edited_filename) }}" 
                           target="_blank" 
                           class="btn btn-outline-info btn-sm" title="View edited version">
                            <i class="bi bi-eye-fill"></i>
                        </a>
                        {% endif %}
                        <button class="btn btn-outline-danger btn-sm" onclick="deletePhoto({{ photo.id }})" title="Delete photo">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <!-- Rename Form (hidden by default) -->
                    <div id="renameForm" class="p-3 border-bottom" style="display: none;">
                        <form method="POST" action="{{ url_for('main.rename_photo', photo_id=photo.id) }}">
                            <div class="input-group">
                                <input type="text" 
                                       class="form-control" 
                                       name="new_name" 
                                       id="newName"
                                       value="{{ photo.original_filename }}" 
                                       placeholder="Enter new photo name"
                                       required>
                                <button type="submit" class="btn btn-success" title="Save changes">
                                    <i class="bi bi-check"></i>
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="toggleRename()" title="Cancel rename">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <img src="{{ url_for('static', filename='uploads/' + photo.filename) }}" 
                         class="img-fluid w-100" 
                         alt="{{ photo.original_filename }}"
                         style="max-height: 70vh; object-fit: contain;">
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Photo Details</h6>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-5">Original Name:</dt>
                        <dd class="col-sm-7">{{ photo.original_filename }}</dd>
                        
                        <dt class="col-sm-5">Uploaded:</dt>
                        <dd class="col-sm-7">{{ photo.uploaded_at.strftime('%Y-%m-%d %H:%M') }}</dd>
                        
                        <dt class="col-sm-5">File Size:</dt>
                        <dd class="col-sm-7">{{ "%.2f"|format(photo.file_size / 1024 / 1024) }} MB</dd>
                        
                        <dt class="col-sm-5">Dimensions:</dt>
                        <dd class="col-sm-7">{{ photo.width }} Ã— {{ photo.height }}</dd>
                        
                        {% if photo.edited_filename %}
                        <dt class="col-sm-5">Status:</dt>
                        <dd class="col-sm-7"><span class="badge bg-success">Edited</span></dd>
                        {% else %}
                        <dt class="col-sm-5">Status:</dt>
                        <dd class="col-sm-7"><span class="badge bg-secondary">Original</span></dd>
                        {% endif %}
                    </dl>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">Actions</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-primary">
                            <i class="bi bi-house"></i> Back to Dashboard
                        </a>
                        <a href="{{ url_for('main.originals') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-images"></i> Back to Gallery
                        </a>
                        <a href="{{ url_for('static', filename='uploads/' + photo.filename) }}" 
                           target="_blank" 
                           class="btn btn-outline-info">
                            <i class="bi bi-arrows-fullscreen"></i> View Full Size
                        </a>
                        <button class="btn btn-danger" onclick="deletePhoto({{ photo.id }})">
                            <i class="bi bi-trash"></i> Delete Photo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function deletePhoto(photoId) {
    if (confirm('Are you sure you want to delete this photo? This action cannot be undone.')) {
        fetch(`/api/photo/delete/${photoId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Photo deleted successfully!');
                window.location.href = '{{ url_for("main.dashboard") }}';
            } else {
                alert('Error deleting photo: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting photo. Please try again.');
        });
    }
}

function toggleRename() {
    const form = document.getElementById('renameForm');
    const input = document.getElementById('newName');
    
    if (form.style.display === 'none') {
        form.style.display = 'block';
        input.focus();
        input.select();
    } else {
        form.style.display = 'none';
    }
}
</script>
{% endblock %}